{"version":3,"file":"uploadimagepopup.min.js","sources":["../src/uploadimagepopup.js"],"sourcesContent":["define([\n    'jquery',\n    'core/ajax',\n    'core/str',\n    'core/templates',\n    'core/notification',\n    'core/modal_factory',\n    'core/fragment',\n    'jqueryui',\n\n], function($, Ajax, str, Templates, Notification, ModalFactory, Fragment) {\n\n    return {\n        init: function(uniqueid) {\n            var form = $('#upload_image_form_' + uniqueid),\n                self = this;\n\n            form.on('keydown', 'input[type=\"text\"]', function(e) {\n                if (e.keyCode === 13) {\n                    e.preventDefault();\n                }\n            });\n\n            // Submit.\n            form.find('.uploadimagesubmit').click(function(event) {\n                self.uploadImage(event, form);\n            });\n\n            // Close modal factory popup.\n            form.find('.uploadimageclose').click(function() {\n                self.closeModalFactory(form);\n            });\n        },\n\n        uploadImage: function(e, form) {\n            let self = this;\n\n            e.preventDefault();\n\n            var serializedForm = form.serializeArray(),\n                data = {};\n\n            serializedForm.forEach(function(item) {\n                data[item.name] = data[item.name] ? data[item.name] + ',' + item.value : item.value;\n            });\n\n            var parseResponse = function(response) {\n                response = JSON.parse(response);\n\n                switch (response.type) {\n                    case 'course':\n                        $('#courseheaderimage').css('background-image', 'url(' + response.imageurl + ')');\n                        break;\n                    case 'singlesection':\n                        $('.card-img').css('background-image', 'url(' + response.imageurl + ')');\n                        break;\n                    case 'multisection':\n                        $('#section-image-' + response.sectionid).css('background-image', 'url(' + response.imageurl + ')');\n                        break;\n                }\n\n                // Close modal factory popup.\n                self.closeModalFactory(form);\n            };\n\n            switch (data.type) {\n                case 'course':\n                    Ajax.call([{\n                        methodname: 'format_flexsections_change_courseimage',\n                        args: {\n                            fileitemid: data.uploadedimage,\n                            courseid: data.courseid,\n                        },\n                        done: parseResponse,\n                        fail: Notification.exception\n                    }]);\n                    break;\n                case 'singlesection':\n                case 'multisection':\n                    Ajax.call([{\n                        methodname: 'format_flexsections_change_sectionimage',\n                        args: {\n                            type: data.type,\n                            fileitemid: data.uploadedimage,\n                            sectionid: data.sectionid,\n                        },\n                        done: parseResponse,\n                        fail: Notification.exception\n                    }]);\n                    break;\n                default:\n                    self.closeModalFactory(form);\n            }\n        },\n\n        closeModalFactory: function(form) {\n            form.parent().parent().parent().find('.close').click();\n        },\n    };\n});\n"],"names":["define","$","Ajax","str","Templates","Notification","ModalFactory","Fragment","init","uniqueid","form","self","this","on","e","keyCode","preventDefault","find","click","event","uploadImage","closeModalFactory","serializedForm","serializeArray","data","forEach","item","name","value","parseResponse","response","JSON","parse","type","css","imageurl","sectionid","call","methodname","args","fileitemid","uploadedimage","courseid","done","fail","exception","parent"],"mappings":"AAAAA,8CAAO,CACH,SACA,YACA,WACA,iBACA,oBACA,qBACA,gBACA,aAED,SAASC,EAAGC,KAAMC,IAAKC,UAAWC,aAAcC,aAAcC,gBAEtD,CACHC,KAAM,SAASC,cACPC,KAAOT,EAAE,sBAAwBQ,UACjCE,KAAOC,KAEXF,KAAKG,GAAG,UAAW,sBAAsB,SAASC,GAC5B,KAAdA,EAAEC,SACFD,EAAEE,oBAKVN,KAAKO,KAAK,sBAAsBC,OAAM,SAASC,OAC3CR,KAAKS,YAAYD,MAAOT,SAI5BA,KAAKO,KAAK,qBAAqBC,OAAM,WACjCP,KAAKU,kBAAkBX,UAI/BU,YAAa,SAASN,EAAGJ,UACjBC,KAAOC,KAEXE,EAAEE,qBAEEM,eAAiBZ,KAAKa,iBACtBC,KAAO,GAEXF,eAAeG,SAAQ,SAASC,MAC5BF,KAAKE,KAAKC,MAAQH,KAAKE,KAAKC,MAAQH,KAAKE,KAAKC,MAAQ,IAAMD,KAAKE,MAAQF,KAAKE,aAG9EC,cAAgB,SAASC,kBACzBA,SAAWC,KAAKC,MAAMF,WAELG,UACR,SACDhC,EAAE,sBAAsBiC,IAAI,mBAAoB,OAASJ,SAASK,SAAW,eAE5E,gBACDlC,EAAE,aAAaiC,IAAI,mBAAoB,OAASJ,SAASK,SAAW,eAEnE,eACDlC,EAAE,kBAAoB6B,SAASM,WAAWF,IAAI,mBAAoB,OAASJ,SAASK,SAAW,KAKvGxB,KAAKU,kBAAkBX,cAGnBc,KAAKS,UACJ,SACD/B,KAAKmC,KAAK,CAAC,CACPC,WAAY,yCACZC,KAAM,CACFC,WAAYhB,KAAKiB,cACjBC,SAAUlB,KAAKkB,UAEnBC,KAAMd,cACNe,KAAMvC,aAAawC,uBAGtB,oBACA,eACD3C,KAAKmC,KAAK,CAAC,CACPC,WAAY,0CACZC,KAAM,CACFN,KAAMT,KAAKS,KACXO,WAAYhB,KAAKiB,cACjBL,UAAWZ,KAAKY,WAEpBO,KAAMd,cACNe,KAAMvC,aAAawC,2BAIvBlC,KAAKU,kBAAkBX,QAInCW,kBAAmB,SAASX,MACxBA,KAAKoC,SAASA,SAASA,SAAS7B,KAAK,UAAUC"}